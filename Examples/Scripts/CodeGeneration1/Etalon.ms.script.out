VOID TestWithDump Etalon.ms.script.test
 VOID PROCEDURE Etalon
  ^ IN aLambda
  VOID PROCEDURE DeleteEmptyFile
   STRING IN aFileName
   aFileName
   FileSize
   0
   ==
   ?
   (
    aFileName
    sysutils:FileExists
    ?
    (
     aFileName
     DeleteFile
     DROP
    )
   )
  ; // VOID PROCEDURE DeleteEmptyFile
  
  STRING VAR l_FileName
  STRING VAR l_FileNameOut
  VOID PROCEDURE Out
   IN aValue
   g_OutFile
   IsNil
   ?FAIL
   'Файл для вывода не открыт'
   aValue
   ToPrintable
   g_OutFile
   File:WriteLn
  ; // VOID PROCEDURE Out
  
  script:FileName
  l_FileName
  pop:Word:SetValue
  ARRAY [
   l_FileName
   if
    (
     g_EtalonCount
     >
     0
    )
   then
    (
     '.'
     g_EtalonCount
     IntToStr
    )
   '.prn'
  ]
  strings:Cat
  l_FileName
  pop:Word:SetValue
  l_FileName
  l_FileNameOut
  pop:Word:SetValue
  l_FileNameOut
  '.out'
  Cat
  l_FileNameOut
  pop:Word:SetValue
  SaveVarAndDo
  g_OutFile
  (
   l_FileNameOut
   File:OpenWrite
   g_OutFile
   pop:Word:SetValue
   DumpStackTo
   (
    aLambda
    DO
   )
   Out
  )
  l_FileName
  DeleteEmptyFile
  l_FileNameOut
  DeleteEmptyFile
  INC
  g_EtalonCount
 ; // VOID PROCEDURE Etalon
 
 INTEGER VAR g_EtalonCount
 Etalon.ms.script.test
 DumpElement
 (
  0
  g_EtalonCount
  pop:Word:SetValue
 )
 Etalon
 script:FileName
 Etalon
 (
  1
  2
  +
 )
 Etalon
 'Hello world'
 Etalon
 NOP
 Etalon
 ARRAY [
 ]
; // VOID TestWithDump Etalon.ms.script.test

