VOID TestWithDump CacheFunction.ms.script.test
 : A
  STRING FUNCTION X
   '1'
   Result
   pop:Word:SetValue
  ; // STRING FUNCTION X
  
  ERROR
  'fake A'
 ; // : A
 
 : B
  STRING FUNCTION X
   '2'
   Result
   pop:Word:SetValue
  ; // STRING FUNCTION X
  
  ERROR
  'fake B'
 ; // : B
 
 IMMEDIATE VOID MACRO Cache
  axiom:PushSymbol
  @SELF
  axiom:PushSymbol
  Cache.do
 ; // IMMEDIATE VOID MACRO Cache
 
 : Cache.do
  TtfwWord IN aCacheWhat
  TtfwWord IN aCacheWhere
  ^ IN aLambda
  STRING VAR l_CacheWhat
  VAR l_FieldVar
  'cached:'
  aCacheWhat
  pop:Word:Name
  Cat
  l_CacheWhat
  pop:Word:SetValue
  l_CacheWhat
  .
  aCacheWhere
  %%
  l_CacheWhat
  l_FieldVar
  pop:Word:SetValue
  l_FieldVar
  .
  if
   (
    l_FieldVar
    NotValid
   )
  then
   BEGIN
    VAR l_NewVar
    l_CacheWhat
    false
    aCacheWhere
    pop:NewWordDefinitor:CheckVar
    l_NewVar
    pop:Word:SetValue
    Cache.do
    l_NewVar
    pop:Word:SetProducer
   END
  aLambda
  DO
 ; // : Cache.do
 
 STRING FUNCTION X
  TtfwWord IN aWord
  aWord
  X
  Cache.do
  (
   aWord
   %%
   'X'
   pop:Word:Name
  )
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 CacheFunction.ms.script.test
 DumpElement
 @
 A
 DumpElement
 @
 B
 DumpElement
 @
 A
 X
 .
 @
 B
 X
 .
 @
 A
 DumpElement
 @
 B
 DumpElement
 @
 A
 X
 .
 @
 B
 X
 .
 @
 A
 DumpElement
 @
 B
 DumpElement
; // VOID TestWithDump CacheFunction.ms.script.test

: A
 STRING FUNCTION X
  '1'
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 ERROR
 'fake A'
; // : A

: B
 STRING FUNCTION X
  '2'
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 ERROR
 'fake B'
; // : B

cached:X
<nil>
X
cached:X
<nil>
X
: A
 Cache.do cached:X
 STRING FUNCTION X
  '1'
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 ERROR
 'fake A'
; // : A

: B
 Cache.do cached:X
 STRING FUNCTION X
  '2'
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 ERROR
 'fake B'
; // : B

cached:X
TkwGlobalVar
X
cached:X
TkwGlobalVar
X
: A
 Cache.do cached:X
 STRING FUNCTION X
  '1'
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 ERROR
 'fake A'
; // : A

: B
 Cache.do cached:X
 STRING FUNCTION X
  '2'
  Result
  pop:Word:SetValue
 ; // STRING FUNCTION X
 
 ERROR
 'fake B'
; // : B

